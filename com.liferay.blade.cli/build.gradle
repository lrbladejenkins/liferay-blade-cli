dependencies {
	testCompile gradleTestKit()
}

task createDepsZip(type:Zip) {
	from "${projectDir}/../com.liferay.blade.gradle/generated/"
	baseName = "deps"
	destinationDir = new File("${projectDir}")
	include "*.jar"
}

task createWrapperZip(type:Zip) {
	from "${projectDir}/../"
	baseName = "wrapper"
	destinationDir = new File("${projectDir}")
	include "gradle/**"
	include "gradlew*"
}

clean.doFirst {
	delete "${projectDir}/deps.zip", "${projectDir}/wrapper.zip"
}

test {
	systemProperty 'verifyBuilds', System.getProperty('verifyBuilds', 'false')
	dependsOn createDepsZip, createWrapperZip
}

jar {
	from createDepsZip, createWrapperZip
}

if (System.env.TRAVIS == 'true') {
  allprojects {
    tasks.withType(GroovyCompile) {
      groovyOptions.fork = false
    }
    tasks.withType(Test) {
      // containers (currently) have 2 dedicated cores and 4GB of memory
      maxParallelForks = 2
      minHeapSize = '128m'
    }
  }
}